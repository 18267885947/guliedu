<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>重置邮箱</title>
    {% load staticfiles %}
    <script src="{% static 'js/jquery-1.12.4.min.js' %}"></script>
</head>
<body>
<p>请输入新的邮箱地址</p>
<input name="email" id="jsChangeEmail" type="text" placeholder="输入重新绑定的邮箱地址">
<input type="text" id="jsChangeEmailCode" name="code" placeholder="输入邮箱验证码">
<input type="button" id="jsChangeEmailCodeBtn" value="获取验证码">
<input id="finish" type="button" value="完成">
</body>
</html>
<script>
    $(function () {
        $('#jsChangeEmailCodeBtn').click(function () {
            var email=$('#jsChangeEmail').val();
            $.ajax({
                type:'POST',
                url:'{% url 'users:user_changeemail' %}',
                data:{
                    email:email,
                    csrfmiddlewaretoken:'{{ csrf_token }}'
                },
                success:function (callback) {
                    alert(callback.msg)
                }
            })
        });
        $('#finish').click(function () {
            var email=$('#jsChangeEmail').val();
            var code=$('#jsChangeEmailCode').val();
            $.ajax({
                type:'POST',
                url:'{% url 'users:user_resetemail' %}',
                data:{
                    email:email,
                    code:code,
                    csrfmiddlewaretoken:'{{ csrf_token }}'
                },
                success:function (callback) {
                    if(callback.status == 'ok'){
                        alert(callback.msg);
                        window.location.href='{% url 'users:user_login' %}'
                    }else {
                        alert(callback.msg);
                    }
                }
            })
        })
    })
</script>


















