<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>个人中心</title>
</head>
{% load staticfiles %}
<script src="{% static 'js/jquery-1.12.4.min.js' %}"></script>
<body>
<li><a href="/">首页</a>>个人中心>个人资料</li><br>
<ul>
    <li><a href="{% url 'users:user_info' %}">个人资料</a></li>
    <li><a href="{% url 'users:user_course' %}">我的课程</a></li>
    <li><a href="{% url 'users:user_love' %}">我的收藏</a></li>
    <li><a href="{% url 'users:user_message' %}">我的信息</a></li>
</ul>
<h1>个人信息</h1>
<form action="{% url 'users:user_changeimage' %}" method="post">
    {% csrf_token %}
    <img width="100" height="100" src="{{ MEDIA_URL }}{{ request.user.image }}">
    <span id="jsAvatarBtn">修改头像</span>
    <input type="file" name="image">
</form>

<form>
    <ul>
        <li>昵称：
            <input type="text" name="nick_name" id="nick_name" value="{{ request.user.nick_name|default_if_none:'' }}" maxlength="10">
            <i class="error_tip"></i>
        </li>
        <li>生日：
            <input type="text" name="birthday" id="birth_day" value="{{ request.user.birthday|default_if_none:'' }}" readonly="readonly">
            <i class="error_tip"></i>
        </li>
        <li>性别：
            <label><input type="radio" name="gender" value="boy" {% if request.user.gender == 'boy' %}checked="checked"{% endif %}>男</label>
            <label><input type="radio" name="gender" value="girl" {% if request.user.gender == 'girl' %}checked="checked"{% endif %}>女</label>
            <i class="error_tip"></i>
        </li>
        <li class="p_infor_city">地址：
            <input type="text" name="address" id="address" placeholder="请输入你的地址" value="{{ request.user.address|default_if_none:'' }}" maxlength="10">
            <i class="error_tip"></i>
        </li>
        <li>手机号：
            <input type="text" name="phone" id="mobile" placeholder="请输入你的手机号" value="{{ request.user.phone|default_if_none:'' }}" maxlength="11">
            <i class="error_tip"></i>
        </li>
        <li>邮箱：
            <input type="text" name="email" readonly="readonly" value="{{ request.user.email  }}">
            <a href="{% url 'users:password_reset' %}">[修改]</a>
        </li>
        <li>
            <input type="button" id="jsEditUserBtn" value="保存">
        </li>
    </ul>
    <input type="hidden" name="csrfmiddlewaretoken" value="">
</form>
</body>
</html>
<script>
    $(function () {
        $('#jsEditUserBtn').click(function () {
            var nick_name=$('#nick_name').val();
            var birthday=$('#birth_day').val();
            var gender=$(':checked').val();
            var address=$('#address').val();
            var phone=$('#mobile').val();
            $.ajax({
                type:'POST',
                url:'{% url 'users:user_changeinfo' %}',
                data:{
                    nick_name:nick_name,
                    birthday:birthday,
                    gender:gender,
                    address:address,
                    phone:phone,
                    csrfmiddlewaretoken:'{{ csrf_token }}'
                },
                success:function (callback) {
                    if(callback.status=='ok'){
                        alert(callback.msg);
                        window.location.reload()
                    }else {
                        alert(callback.msg)
                    }
                }
            })
        })
    })
</script>




